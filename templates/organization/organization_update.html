{% extends "base.html" %}

{% block content %}
    <script>
        document.body.addEventListener("htmx:afterSwap", (event) => {
            if (event.detail.target.id === "error-messages") {
                document.getElementById("error-messages")
                    .scrollIntoView({behavior: "smooth", block: "center"});
            }
        });
    </script>

    {% include "partials/navbar.html" %}

    <main class="flex-grow self-center mt-10 mb-12 px-5 w-full max-w-6xl">
        <!-- back button -->
        <div class="mb-2 text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors">
            <button onclick="handleBack()" class="inline-flex items-center gap-2 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="lucide lucide-move-left-icon lucide-move-left">
                    <path d="M6 8L2 12L6 16"/>
                    <path d="M2 12H22"/>
                </svg>

                <span>Back</span>
            </button>
        </div>

        <div class="flex flex-wrap justify-between items-center gap-3 mb-6">
            <h2 class="font-bold text-2xl">Edit Organization</h2>
        </div>

        <div id="error-messages"
             class="transition-all duration-300 flex items-center mx-auto max-w-lg w-full mb-3">
            {% include "partials/flash_messages.html" %}
        </div>

        <div class="flex items-center mx-auto max-w-lg">
            <form hx-post="{{ url_for('organization_update', org_id=org.org_id) }}"
                  hx-target="#error-messages"
                  hx-swap="innerHTML"
                  hx-disabled-elt="#submit-button"
                  hx-encoding="multipart/form-data"
                  method="post"
                  class="group flex flex-col w-full">

                <!-- Name -->
                <label for="name" class="font-semibold text-lg">Name</label>
                <input
                        type="text"
                        id="name"
                        name="name"
                        required
                        value="{{ org.org_name }}"
                        placeholder="Enter the organization name"
                        class="bg-gray-50 shadow shadow-gray-100 mt-1 p-3 border border-gray-300 focus:border-utdOrange rounded-md outline-none focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300"
                />

                <!-- Type -->
                <label for="org_type" class="mt-4 font-semibold text-lg">Organization Type</label>
                <select
                        id="org_type"
                        name="org_type"
                        required
                        class="block w-full mt-1 p-3 bg-gray-100 border border-gray-200 text-heading text-sm rounded-md outline-none focus:border-utdOrange focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300 shadow-xs"
                >
                    <option value="" disabled>Choose a type</option>
                    {% for type in [
                        'academic','administrative','advocacy','arts','business', 'career',
                        'community-service','cultural','entrepreneurship','environmental','esports',
                        'health-wellness','international','media','professional','recreational',
                        'research','social', 'sports','sustainability','technical'
                    ] %}
                        <option value="{{ type }}"
                                {% if org.org_type == type %}selected{% endif %}>
                            {{ type | capitalize }}
                        </option>
                    {% endfor %}
                </select>

                <!-- Image -->
                <label for="org_image" class="mt-4 font-semibold text-lg">Update Organization Image</label>
                <div class="bg-gray-50 shadow-md p-2 my-4 w-40 flex flex-col rounded-md">
                    <img src="{{ org.org_image_url }}" alt="{{ org.org_name }}"
                         class="w-32 object-contain self-center rounded-md"/>
                    <p class="text-sm text-gray-600 text-center mt-2">Current Image</p>
                </div>
                <input
                        type="file"
                        id="org_image"
                        name="org_image"
                        accept="image/png, image/jpeg"
                        class="bg-gray-50 hover:file:bg-orange-400 file:bg-orange-300 shadow shadow-gray-100 file:mr-5 file:px-4 file:py-2 border border-gray-300 file:border-0 rounded-lg file:rounded-md outline-none file:font-semibold text-gray-500 file:text-black text-sm file:text-sm"
                />

                <!-- Email -->
                <label for="org_email" class="mt-4 font-semibold text-lg">Organization Email</label>
                <input
                        type="email"
                        id="org_email"
                        name="org_email"
                        value="{{ org.org_email }}"
                        required
                        class="bg-gray-50 shadow shadow-gray-100 mt-1 p-3 border border-gray-300 focus:border-utdOrange rounded-md outline-none focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300"
                />

                <button id="submit-button"
                        type="submit"
                        class="group flex justify-center items-center bg-utdOrange hover:bg-orange-500 hover:shadow-lg mt-6 px-3 py-3 rounded-lg font-semibold text-white text-lg transition hover:-translate-y-0.5 duration-250 ease-in-out hover:cursor-pointer group-[.htmx-request]:disabled:opacity-50 group-[.htmx-request]:disabled:cursor-not-allowed">
                    <svg class="hidden group-[.htmx-request]:block animate-spin mr-2 h-5 w-5 text-gray-200"
                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                    </svg>
                    <span class="group-[.htmx-request]:hidden">Save Changes</span>
                </button>
            </form>
        </div>
    </main>
{% endblock content %}
