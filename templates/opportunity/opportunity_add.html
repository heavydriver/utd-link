{% extends "base.html" %}

{% block content %}
    <script>
        document.body.addEventListener("htmx:afterSwap", (event) => {
            if (event.detail.target.id === "error-messages") {
                document.getElementById("error-messages")
                    .scrollIntoView({behavior: "smooth", block: "center"});
            }
        });
    </script>

    <!-- navbar -->
    {% include "partials/navbar.html" %}

    <!-- main content -->
    <main class="flex-grow self-center mt-10 mb-12 px-5 w-full max-w-6xl">
        <!-- rich text input -->
        <link
                href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css"
                rel="stylesheet"
        />
        <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>

        <!-- back button -->
        <div class="mb-2 text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors">
            <button onclick="handleBack()" class="inline-flex items-center gap-2 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="lucide lucide-move-left-icon lucide-move-left">
                    <path d="M6 8L2 12L6 16"/>
                    <path d="M2 12H22"/>
                </svg>

                <span>Back</span>
            </button>
        </div>

        <!-- header -->
        <div class="flex flex-wrap justify-between items-center gap-3 mb-6">
            <h2 class="font-bold text-2xl">Add New Opportunity</h2>
        </div>

        <!-- error messages -->
        <div id="error-messages" class="transition-all duration-300 flex items-center mx-auto max-w-lg w-full mb-3">
            {% include "partials/flash_messages.html" %}
        </div>

        <div class="flex items-center mx-auto max-w-lg">
            <!-- create opportunity form -->
            <form id="newOpportunityForm" hx-post="{{ url_for("opportunity_create", org_id=org_id) }}"
                  hx-target="#error-messages"
                  hx-swap="innerHTML"
                  hx-disabled-elt="#submit-button" method="post" hx-encoding="multipart/form-data"
                  class="group flex flex-col w-full">
                <label for="title" class="font-semibold text-lg">Title</label>
                <input
                        type="text"
                        id="title"
                        name="title"
                        placeholder="Enter the title"
                        required
                        class="bg-gray-50 shadow shadow-gray-100 mt-1 p-3 border border-gray-300 focus:border-utdOrange rounded-md outline-none focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300"
                />

                <label for="category" class="mt-4 font-semibold text-lg">Category</label>
                <select
                        id="category"
                        name="category"
                        required
                        class="block w-full mt-1 p-3 bg-gray-100 border border-gray-200 text-heading text-sm rounded-md outline-none focus:border-utdOrange focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300 shadow-xs"
                >
                    <option value="" selected>Choose a category</option>
                    <option value="career_development">Career Development</option>
                    <option value="career_fair">Career Fair</option>
                    <option value="competition">Competition</option>
                    <option value="conference">Conference</option>
                    <option value="guest_lecture">Guest Lecture</option>
                    <option value="hackathon">Hackathon</option>
                    <option value="internship_info">Internship Info</option>
                    <option value="networking_event">Networking Event</option>
                    <option value="panel_discussion">Panel Discussion</option>
                    <option value="research_opportunity">Research Opportunity</option>
                    <option value="seminar">Seminar</option>
                    <option value="social_event">Social Event</option>
                    <option value="training_session">Training Session</option>
                    <option value="volunteering">Volunteering</option>
                    <option value="workshop">Workshop</option>
                </select>

                <label for="description" class="mt-4 font-semibold text-lg"
                >Description</label
                >
                <div id="editor"></div>
                <input
                        type="hidden"
                        id="hidden-description-input"
                        name="description"
                        class="bg-gray-50 shadow shadow-gray-100 mt-1 p-3 border border-gray-300 focus:border-utdOrange rounded-md outline-none focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300"
                />

                <script>
                    const quill = new Quill("#editor", {
                        theme: "snow",
                        modules: {
                            toolbar: [
                                // Customize the toolbar options
                                [{header: [1, 2, false]}],
                                ["bold", "italic", "underline", "strike"],
                                ["link", "blockquote", "code-block", "image"],
                                [{list: "ordered"}, {list: "bullet"}],
                                ["clean"],
                            ],
                        },
                    })

                    const hiddenInput = document.getElementById(
                        "hidden-description-input"
                    )

                    quill.on("text-change", function () {
                        hiddenInput.value = quill.root.innerHTML
                    })

                    document
                        .getElementById("newOpportunityForm")
                        .addEventListener("submit", function () {
                            hiddenInput.value = quill.root.innerHTML
                        })
                </script>

                <!-- start/end date -->
                <div class="flex sm:flex-row flex-col gap-4 mt-4 w-full">
                    <div class="flex flex-col">
                        <label for="startDate" class="font-semibold text-lg"
                        >Start Date</label
                        >
                        <input
                                type="date"
                                id="startDate"
                                name="startDate"
                                required
                                class="bg-gray-50 shadow shadow-gray-100 mt-1 p-3 border border-gray-300 focus:border-utdOrange rounded-md outline-none focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300"
                        />
                    </div>

                    <div class="flex flex-col">
                        <label for="endDate" class="font-semibold text-lg"
                        >End Date</label
                        >
                        <input
                                type="date"
                                id="endDate"
                                name="endDate"
                                class="bg-gray-50 shadow shadow-gray-100 mt-1 p-3 border border-gray-300 focus:border-utdOrange rounded-md outline-none focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300"
                        />
                    </div>
                </div>

                <label for="flyer" class="mt-4 font-semibold text-lg"
                >Upload Flyer</label
                >
                <input
                        type="file"
                        id="flyer"
                        name="flyer"
                        accept="image/png, image/jpeg"
                        class="bg-gray-50 hover:file:bg-orange-400 file:bg-orange-300 shadow shadow-gray-100 file:mr-5 file:px-4 file:py-2 border border-gray-300 file:border-0 rounded-lg file:rounded-md outline-none file:font-semibold text-gray-500 file:text-black text-sm file:text-sm"
                />

                <label for="maxSignups" class="mt-4 font-semibold text-lg"
                >Maximum Signups</label
                >
                <input
                        type="number"
                        id="maxSignups"
                        name="maxSignups"
                        class="bg-gray-50 shadow shadow-gray-100 mt-1 p-3 border border-gray-300 focus:border-utdOrange rounded-md outline-none focus:ring-2 focus:ring-utdOrange/50 transition-colors duration-300"
                />

                <button id="submit-button"
                        type="submit"
                        class="group flex justify-center items-center bg-utdOrange hover:bg-orange-500 hover:shadow-lg mt-6 px-3 py-3 rounded-lg font-semibold text-white text-lg transition hover:-translate-y-0.5 duration-250 ease-in-out hover:cursor-pointer group-[.htmx-request]:disabled:opacity-50 group-[.htmx-request]:disabled:cursor-not-allowed">
                    <svg class="hidden group-[.htmx-request]:block animate-spin mr-2 h-5 w-5 text-gray-200"
                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                    </svg>

                    <span class="group-[.htmx-request]:hidden">Submit</span>
                </button>
            </form>
        </div>
    </main>
{% endblock content %}
